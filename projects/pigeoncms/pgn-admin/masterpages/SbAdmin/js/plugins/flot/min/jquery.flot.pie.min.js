!function(e){function t(t){function s(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.series.pie.label.show=t.legend.show?!1:!0),"auto"==t.series.pie.radius&&(t.series.pie.radius=t.series.pie.label.show?.75:1),t.series.pie.tilt>1&&(t.series.pie.tilt=1),t.series.pie.tilt<0&&(t.series.pie.tilt=0),e.hooks.processDatapoints.push(l),e.hooks.drawOverlay.push(k),e.hooks.draw.push(d))}function r(e,t){var i=e.getOptions();i.series.pie.show&&i.grid.hoverable&&t.unbind("mousemove").mousemove(f),i.series.pie.show&&i.grid.clickable&&t.unbind("click").click(v)}function n(e){for(var t=0;t<e.length;++t){var i=parseFloat(e[t].data[0][1]);i&&(R+=i)}}function l(t){D||(D=!0,m=t.getCanvas(),A=e(m).parent(),a=t.getOptions(),t.setData(c(t.getData())))}function o(){F=A.children().filter(".legend").children().width(),I=Math.min(m.width,m.height/a.series.pie.tilt)/2,Y=m.height/2+a.series.pie.offset.top,X=m.width/2,"auto"==a.series.pie.offset.left?a.legend.position.match("w")?X+=F/2:X-=F/2:X+=a.series.pie.offset.left,I>X?X=I:X>m.width-I&&(X=m.width-I)}function p(e){for(var t=0;t<e.length;++t)"number"==typeof e[t].data?e[t].data=[[1,e[t].data]]:("undefined"==typeof e[t].data||"undefined"==typeof e[t].data[0])&&("undefined"!=typeof e[t].data&&"undefined"!=typeof e[t].data.label&&(e[t].label=e[t].data.label),e[t].data=[[1,0]]);return e}function c(e){e=p(e),n(e);for(var t=0,i=0,s=a.series.pie.combine.color,r=[],l=0;l<e.length;++l)e[l].data[0][1]=parseFloat(e[l].data[0][1]),e[l].data[0][1]||(e[l].data[0][1]=0),e[l].data[0][1]/R<=a.series.pie.combine.threshold?(t+=e[l].data[0][1],i++,s||(s=e[l].color)):r.push({data:[[1,e[l].data[0][1]]],color:e[l].color,label:e[l].label,angle:2*e[l].data[0][1]*Math.PI/R,percent:e[l].data[0][1]/R*100});return i>0&&r.push({data:[[1,t]],color:s,label:a.series.pie.combine.label,angle:2*t*Math.PI/R,percent:t/R*100}),r}function d(t,i){function s(){ctx.clearRect(0,0,m.width,m.height),A.children().filter(".pieLabel, .pieLabelBackground").remove()}function r(){var e=5,t=15,i=10,s=.02;if(a.series.pie.radius>1)var r=a.series.pie.radius;else var r=I*a.series.pie.radius;if(!(r>=m.width/2-e||r*a.series.pie.tilt>=m.height/2-t||i>=r)){ctx.save(),ctx.translate(e,t),ctx.globalAlpha=s,ctx.fillStyle="#000",ctx.translate(X,Y),ctx.scale(1,a.series.pie.tilt);for(var n=1;i>=n;n++)ctx.beginPath(),ctx.arc(0,0,r,0,2*Math.PI,!1),ctx.fill(),r-=n;ctx.restore()}}function n(){function t(t,i,a){0>=t||(a?ctx.fillStyle=i:(ctx.strokeStyle=i,ctx.lineJoin="round"),ctx.beginPath(),Math.abs(t-2*Math.PI)>1e-9?ctx.moveTo(0,0):e.browser.msie&&(t-=1e-4),ctx.arc(0,0,s,r,r+t,!1),ctx.closePath(),r+=t,a?ctx.fill():ctx.stroke())}function i(){function t(t,i,r){if(0!=t.data[0][1]){var n,l=a.legend.labelFormatter,o=a.series.pie.label.formatter;n=l?l(t.label,t):t.label,o&&(n=o(n,t));var p=(i+t.angle+i)/2,c=X+Math.round(Math.cos(p)*s),d=Y+Math.round(Math.sin(p)*s)*a.series.pie.tilt,h='<span class="pieLabel" id="pieLabel'+r+'" style="position:absolute;top:'+d+"px;left:"+c+'px;">'+n+"</span>";A.append(h);var u=A.children("#pieLabel"+r),g=d-u.height()/2,f=c-u.width()/2;if(u.css("top",g),u.css("left",f),(0-g>0||0-f>0||m.height-(g+u.height())<0||m.width-(f+u.width())<0)&&(O=!0),0!=a.series.pie.label.background.opacity){var v=a.series.pie.label.background.color;null==v&&(v=t.color);var b="top:"+g+"px;left:"+f+"px;";e('<div class="pieLabelBackground" style="position:absolute;width:'+u.width()+"px;height:"+u.height()+"px;"+b+"background-color:"+v+';"> </div>').insertBefore(u).css("opacity",a.series.pie.label.background.opacity)}}}var i=startAngle;if(a.series.pie.label.radius>1)var s=a.series.pie.label.radius;else var s=I*a.series.pie.label.radius;for(var r=0;r<l.length;++r)l[r].percent>=100*a.series.pie.label.threshold&&t(l[r],i,r),i+=l[r].angle}if(startAngle=Math.PI*a.series.pie.startAngle,a.series.pie.radius>1)var s=a.series.pie.radius;else var s=I*a.series.pie.radius;ctx.save(),ctx.translate(X,Y),ctx.scale(1,a.series.pie.tilt),ctx.save();for(var r=startAngle,n=0;n<l.length;++n)l[n].startAngle=r,t(l[n].angle,l[n].color,!0);ctx.restore(),ctx.save(),ctx.lineWidth=a.series.pie.stroke.width,r=startAngle;for(var n=0;n<l.length;++n)t(l[n].angle,a.series.pie.stroke.color,!1);ctx.restore(),h(ctx),a.series.pie.label.show&&i(),ctx.restore()}if(A){ctx=i,o();for(var l=t.getData(),p=0;O&&L>p;)O=!1,p>0&&(I*=S),p+=1,s(),a.series.pie.tilt<=.8&&r(),n();p>=L&&(s(),A.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),t.setSeries&&t.insertLegend&&(t.setSeries(l),t.insertLegend())}}function h(e){a.series.pie.innerRadius>0&&(e.save(),innerRadius=a.series.pie.innerRadius>1?a.series.pie.innerRadius:I*a.series.pie.innerRadius,e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=a.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=a.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore())}function u(e,t){for(var i=!1,a=-1,s=e.length,r=s-1;++a<s;r=a)(e[a][1]<=t[1]&&t[1]<e[r][1]||e[r][1]<=t[1]&&t[1]<e[a][1])&&t[0]<(e[r][0]-e[a][0])*(t[1]-e[a][1])/(e[r][1]-e[a][1])+e[a][0]&&(i=!i);return i}function g(e,i){for(var a=t.getData(),s=t.getOptions(),r=s.series.pie.radius>1?s.series.pie.radius:I*s.series.pie.radius,n=0;n<a.length;++n){var l=a[n];if(l.pie.show){if(ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,r,l.startAngle,l.startAngle+l.angle,!1),ctx.closePath(),x=e-X,y=i-Y,ctx.isPointInPath){if(ctx.isPointInPath(e-X,i-Y))return ctx.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:n}}else if(p1X=r*Math.cos(l.startAngle),p1Y=r*Math.sin(l.startAngle),p2X=r*Math.cos(l.startAngle+l.angle/4),p2Y=r*Math.sin(l.startAngle+l.angle/4),p3X=r*Math.cos(l.startAngle+l.angle/2),p3Y=r*Math.sin(l.startAngle+l.angle/2),p4X=r*Math.cos(l.startAngle+l.angle/1.5),p4Y=r*Math.sin(l.startAngle+l.angle/1.5),p5X=r*Math.cos(l.startAngle+l.angle),p5Y=r*Math.sin(l.startAngle+l.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y],u(arrPoly,arrPoint))return ctx.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:n};ctx.restore()}}return null}function f(e){b("plothover",e)}function v(e){b("plotclick",e)}function b(e,i){var s=t.offset(),r=parseInt(i.pageX-s.left),n=parseInt(i.pageY-s.top),l=g(r,n);if(a.grid.autoHighlight)for(var o=0;o<B.length;++o){var p=B[o];p.auto!=e||l&&p.series==l.series||P(p.series)}l&&w(l.series,e);var c={pageX:i.pageX,pageY:i.pageY};A.trigger(e,[c,l])}function w(e,i){"number"==typeof e&&(e=series[e]);var a=M(e);-1==a?(B.push({series:e,auto:i}),t.triggerRedrawOverlay()):i||(B[a].auto=!1)}function P(e){null==e&&(B=[],t.triggerRedrawOverlay()),"number"==typeof e&&(e=series[e]);var i=M(e);-1!=i&&(B.splice(i,1),t.triggerRedrawOverlay())}function M(e){for(var t=0;t<B.length;++t){var i=B[t];if(i.series==e)return t}return-1}function k(e,t){function a(e){e.angle<0||(t.fillStyle="rgba(255, 255, 255, "+s.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&t.moveTo(0,0),t.arc(0,0,r,e.startAngle,e.startAngle+e.angle,!1),t.closePath(),t.fill())}var s=e.getOptions(),r=s.series.pie.radius>1?s.series.pie.radius:I*s.series.pie.radius;for(t.save(),t.translate(X,Y),t.scale(1,s.series.pie.tilt),i=0;i<B.length;++i)a(B[i].series);h(t),t.restore()}var m=null,A=null,I=null,X=null,Y=null,R=0,O=!0,L=10,S=.95,F=0,D=!1,B=[];t.hooks.processOptions.push(s),t.hooks.bindEvents.push(r)}var a={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(e,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:t,options:a,name:"pie",version:"1.0"})}(jQuery);